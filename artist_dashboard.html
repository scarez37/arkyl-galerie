<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Espace Artiste - Ma Galerie</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-left h1 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .header-left p {
            color: #666;
        }

        .header-right {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .user-info {
            text-align: right;
        }

        .user-name {
            font-weight: 600;
            color: #333;
        }

        .user-email {
            font-size: 14px;
            color: #666;
        }

        .btn-logout {
            padding: 10px 20px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-logout:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }

        .artist-info {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .add-artwork-form {
            background: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            display: none;
        }

        .add-artwork-form.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .artwork-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 30px;
        }

        .artwork-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 0.3s;
        }

        .artwork-card:hover {
            transform: translateY(-5px);
        }

        .artwork-image {
            width: 100%;
            height: 250px;
            object-fit: cover;
        }

        .artwork-info {
            padding: 20px;
        }

        .artwork-title {
            font-size: 20px;
            color: #333;
            margin-bottom: 10px;
        }

        .artwork-category {
            display: inline-block;
            padding: 5px 15px;
            background: #667eea;
            color: white;
            border-radius: 20px;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .artwork-price {
            font-size: 24px;
            color: #764ba2;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .artwork-actions {
            display: flex;
            gap: 10px;
        }

        .btn-small {
            padding: 8px 20px;
            font-size: 14px;
            flex: 1;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .btn-edit {
            background: #3498db;
            color: white;
        }

        .btn-edit:hover {
            background: #2980b9;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 10px;
            color: white;
            font-weight: 600;
            display: none;
            z-index: 1000;
            animation: slideIn 0.3s;
        }

        .notification.success {
            background: #27ae60;
        }

        .notification.error {
            background: #e74c3c;
        }

        .notification.show {
            display: block;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .image-preview {
            margin-top: 10px;
            max-width: 300px;
            border-radius: 8px;
            display: none;
        }

        .image-preview.show {
            display: block;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 50px;
            color: white;
            font-size: 18px;
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                text-align: center;
                gap: 20px;
            }

            .header-right {
                width: 100%;
                flex-direction: column;
            }

            .user-info {
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <!-- Loading screen -->
    <div class="loading" id="loadingScreen">
        <i class="fas fa-spinner fa-spin" style="font-size: 48px;"></i>
        <p>Vérification de la session...</p>
    </div>

    <!-- Main container (hidden until auth check) -->
    <div class="container" id="mainContainer" style="display: none;">
        <div class="header">
            <div class="header-left">
                <h1><i class="fas fa-palette"></i> Espace Artiste</h1>
                <p>Gérez vos œuvres et partagez votre art avec le monde</p>
            </div>
            <div class="header-right">
                <div class="user-info">
                    <div class="user-name" id="userName">-</div>
                    <div class="user-email" id="userEmail">-</div>
                </div>
                <button class="btn-logout" onclick="handleLogout()">
                    <i class="fas fa-sign-out-alt"></i>
                    Déconnexion
                </button>
            </div>
        </div>

        <div class="artist-info">
            <div>
                <h2 id="artistName">-</h2>
                <p style="color: #666;">Artiste depuis <span id="memberSince">2024</span></p>
            </div>
            <button class="btn btn-primary" onclick="toggleAddForm()">
                <i class="fas fa-plus"></i> Ajouter une œuvre
            </button>
        </div>

        <!-- Formulaire d'ajout d'œuvre -->
        <div class="add-artwork-form" id="addArtworkForm">
            <h2 style="margin-bottom: 20px; color: #667eea;">
                <i class="fas fa-image"></i> Nouvelle Œuvre
            </h2>
            <form id="artworkForm" onsubmit="addArtwork(event)">
                <div class="form-group">
                    <label for="title">Titre de l'œuvre *</label>
                    <input type="text" id="title" name="title" required>
                </div>

                <div class="form-group">
                    <label for="category">Catégorie *</label>
                    <select id="category" name="category" required>
                        <option value="">Choisir une catégorie</option>
                        <option value="Peinture">Peinture</option>
                        <option value="Sculpture">Sculpture</option>
                        <option value="Photographie">Photographie</option>
                        <option value="Art Numérique">Art Numérique</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="price">Prix (€) *</label>
                    <input type="number" id="price" name="price" min="0" step="0.01" required>
                </div>

                <div class="form-group">
                    <label for="image_url">URL de l'image *</label>
                    <input type="url" id="image_url" name="image_url" required 
                           onchange="previewImage(this.value)">
                    <img id="imagePreview" class="image-preview" alt="Aperçu">
                </div>

                <div class="form-group">
                    <label for="description">Description</label>
                    <textarea id="description" name="description" 
                              placeholder="Décrivez votre œuvre..."></textarea>
                </div>

                <div style="display: flex; gap: 10px;">
                    <button type="submit" class="btn btn-primary" style="flex: 1;">
                        <i class="fas fa-save"></i> Enregistrer
                    </button>
                    <button type="button" class="btn btn-danger" onclick="toggleAddForm()" 
                            style="flex: 1;">
                        <i class="fas fa-times"></i> Annuler
                    </button>
                </div>
            </form>
        </div>

        <!-- Grille des œuvres -->
        <div class="artwork-grid" id="artworkGrid">
            <!-- Les œuvres seront chargées ici dynamiquement -->
        </div>
    </div>

    <div class="notification" id="notification"></div>

    <script>
        const API_URL = 'api_mysql.php';  // ou 'api.php' selon votre configuration
        const AUTH_URL = 'auth.php';
        let ARTIST_ID = null;
        let currentUser = null;

        // Vérifier l'authentification au chargement
        document.addEventListener('DOMContentLoaded', async () => {
            await checkAuthentication();
        });

        // Vérifier si l'utilisateur est connecté
        async function checkAuthentication() {
            try {
                const response = await fetch(`${AUTH_URL}?action=check_session`);
                const data = await response.json();
                
                if (data.success && data.logged_in) {
                    // Utilisateur connecté
                    currentUser = data.user;
                    ARTIST_ID = data.user.id;
                    
                    // Mettre à jour l'interface
                    document.getElementById('userName').textContent = data.user.name;
                    document.getElementById('userEmail').textContent = data.user.email;
                    document.getElementById('artistName').textContent = data.user.artist_name;
                    
                    // Calculer l'année d'inscription (approximatif)
                    const currentYear = new Date().getFullYear();
                    document.getElementById('memberSince').textContent = currentYear;
                    
                    // Afficher le contenu
                    document.getElementById('loadingScreen').style.display = 'none';
                    document.getElementById('mainContainer').style.display = 'block';
                    
                    // Charger les œuvres
                    loadArtworks();
                    
                } else {
                    // Pas connecté - rediriger vers login
                    window.location.href = 'login.html';
                }
                
            } catch (error) {
                console.error('Erreur de vérification:', error);
                // En cas d'erreur, rediriger vers login
                window.location.href = 'login.html';
            }
        }

        // Déconnexion
        async function handleLogout() {
            if (!confirm('Voulez-vous vraiment vous déconnecter ?')) {
                return;
            }
            
            try {
                await fetch(`${AUTH_URL}?action=logout`);
                window.location.href = 'login.html';
            } catch (error) {
                console.error('Erreur de déconnexion:', error);
                // Rediriger quand même
                window.location.href = 'login.html';
            }
        }

        // Basculer l'affichage du formulaire
        function toggleAddForm() {
            const form = document.getElementById('addArtworkForm');
            form.classList.toggle('active');
            if (!form.classList.contains('active')) {
                document.getElementById('artworkForm').reset();
                document.getElementById('imagePreview').classList.remove('show');
            }
        }

        // Prévisualiser l'image
        function previewImage(url) {
            const preview = document.getElementById('imagePreview');
            preview.src = url;
            preview.classList.add('show');
        }

        // Afficher une notification
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Charger les œuvres de l'artiste
        async function loadArtworks() {
            try {
                const response = await fetch(`${API_URL}?action=artist_artworks&artist_id=${ARTIST_ID}`);
                const data = await response.json();
                
                if (data.success) {
                    displayArtworks(data.data);
                }
            } catch (error) {
                console.error('Erreur:', error);
                showNotification('Erreur lors du chargement des œuvres', 'error');
            }
        }

        // Afficher les œuvres
        function displayArtworks(artworks) {
            const grid = document.getElementById('artworkGrid');
            
            if (artworks.length === 0) {
                grid.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 50px; color: white;">
                        <i class="fas fa-palette" style="font-size: 60px; opacity: 0.5;"></i>
                        <p style="margin-top: 20px; font-size: 18px;">Aucune œuvre pour le moment</p>
                        <p style="opacity: 0.8;">Cliquez sur "Ajouter une œuvre" pour commencer</p>
                    </div>
                `;
                return;
            }
            
            grid.innerHTML = artworks.map(artwork => `
                <div class="artwork-card">
                    <img src="${artwork.image_url}" alt="${artwork.title}" class="artwork-image"
                         onerror="this.src='https://via.placeholder.com/400x250?text=Image+non+disponible'">
                    <div class="artwork-info">
                        <h3 class="artwork-title">${artwork.title}</h3>
                        <span class="artwork-category">${artwork.category}</span>
                        <div class="artwork-price">${parseFloat(artwork.price).toFixed(2)} €</div>
                        ${artwork.description ? `<p style="color: #666; margin-bottom: 15px; font-size: 14px;">${artwork.description}</p>` : ''}
                        <div class="artwork-actions">
                            <button class="btn btn-small btn-edit" onclick="editArtwork(${artwork.id})">
                                <i class="fas fa-edit"></i> Modifier
                            </button>
                            <button class="btn btn-small btn-danger" onclick="deleteArtwork(${artwork.id})">
                                <i class="fas fa-trash"></i> Supprimer
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Ajouter une œuvre
        async function addArtwork(event) {
            event.preventDefault();
            
            const formData = {
                artist_id: ARTIST_ID,
                title: document.getElementById('title').value,
                category: document.getElementById('category').value,
                price: parseFloat(document.getElementById('price').value),
                image_url: document.getElementById('image_url').value,
                description: document.getElementById('description').value
            };

            try {
                const response = await fetch(`${API_URL}?action=add_artwork`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });

                const data = await response.json();
                
                if (data.success) {
                    showNotification('Œuvre ajoutée avec succès !');
                    toggleAddForm();
                    loadArtworks();
                } else {
                    showNotification(data.message, 'error');
                }
            } catch (error) {
                console.error('Erreur:', error);
                showNotification('Erreur lors de l\'ajout de l\'œuvre', 'error');
            }
        }

        // Supprimer une œuvre
        async function deleteArtwork(id) {
            if (!confirm('Êtes-vous sûr de vouloir supprimer cette œuvre ?')) {
                return;
            }

            try {
                const response = await fetch(`${API_URL}?action=delete_artwork&id=${id}`, {
                    method: 'DELETE'
                });

                const data = await response.json();
                
                if (data.success) {
                    showNotification('Œuvre supprimée avec succès !');
                    loadArtworks();
                } else {
                    showNotification(data.message, 'error');
                }
            } catch (error) {
                console.error('Erreur:', error);
                showNotification('Erreur lors de la suppression', 'error');
            }
        }

        // Modifier une œuvre (à implémenter)
        function editArtwork(id) {
            showNotification('Fonction de modification en cours de développement', 'error');
        }
    </script>
</body>
</html>
